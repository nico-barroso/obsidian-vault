

|**Concepto clave**|**Nota útil**|
|---|---|
|**Tipo**|Script DDL (_Data Definition Language_).|
|**Motor**|PostgreSQL (deducido por tipos como `NUMERIC` o `VARCHAR` y sintaxis).|
|**Integridad**|Uso estricto de **Foreign Keys** y **Constraints** (`CHECK`).|

### 1. Tipos de Relaciones Implementadas

El script muestra los tres patrones fundamentales de modelado relacional:

- **1:1 (Uno a Uno) - `cliente` <-> `detalle_cliente`**
    
    - **Estrategia:** La tabla débil (`detalle_cliente`) usa la misma **Primary Key** que la tabla fuerte.
        
    - `id` es a la vez PK y FK.
        
    - **Integridad:** `ON DELETE CASCADE`. Si borras el cliente, se borran sus detalles automáticamente.
        
- **1:N (Uno a Muchos) - `cliente` <-> `pedido`**
    
    - **Estrategia:** Propagación de clave. La tabla "Muchos" (`pedido`) tiene una FK (`cliente_id`) apuntando a la tabla "Uno".
        
    - **Integridad:** `ON DELETE RESTRICT`. No puedes borrar un cliente si tiene pedidos asociados (protege el histórico de ventas).
        
- **N:M (Muchos a Muchos) - `pedido` <-> `producto`**
    
    - **Estrategia:** Tabla intermedia (`detalle_pedido`).
        
    - **Clave:** Posee una **Primary Key Compuesta** `(pedido_id, producto_id)`.
        
    - **Datos extra:** Almacena atributos propios de la relación como `cantidad` y `precio_unit` (histórico de precio al momento de la compra).
        

### Código SQL Estructurado

SQL

```sql
-- 1. Entidad Fuerte
CREATE TABLE IF NOT EXISTS cliente (
    id INT PRIMARY KEY,
    nombre VARCHAR(120) NOT NULL,
    email VARCHAR(200) NOT NULL UNIQUE
);

-- 2. Relación 1:1 (PK compartida)
CREATE TABLE IF NOT EXISTS detalle_cliente (
    id INT PRIMARY KEY, 
    direccion VARCHAR(200),
    telefono VARCHAR(40),
    notas VARCHAR(200),
    -- La FK es la propia PK
    CONSTRAINT fk_det_cliente FOREIGN KEY (id) 
        REFERENCES cliente(id) ON DELETE CASCADE
);

-- 3. Entidad de Catálogo
CREATE TABLE IF NOT EXISTS producto (
    id INT PRIMARY KEY,
    nombre VARCHAR(120) NOT NULL,
    precio NUMERIC(12,2) NOT NULL CHECK (precio >= 0)
);

-- 4. Relación 1:N (Cabecera de Pedido)
CREATE TABLE IF NOT EXISTS pedido (
    id INT PRIMARY KEY,
    cliente_id INT NOT NULL,
    fecha DATE NOT NULL,
    CONSTRAINT fk_pedido_cliente FOREIGN KEY (cliente_id)
        REFERENCES cliente(id) ON DELETE RESTRICT
);

-- 5. Relación N:M (Líneas de Pedido)
CREATE TABLE IF NOT EXISTS detalle_pedido (
    pedido_id INT NOT NULL,
    producto_id INT NOT NULL,
    cantidad INT NOT NULL CHECK (cantidad > 0),
    precio_unit NUMERIC(12,2) NOT NULL CHECK (precio_unit >= 0),
    
    -- PK Compuesta: Un producto solo puede aparecer una vez por pedido
    PRIMARY KEY (pedido_id, producto_id),
    
    CONSTRAINT fk_dp_pedido FOREIGN KEY (pedido_id) 
        REFERENCES pedido(id) ON DELETE CASCADE,
    CONSTRAINT fk_dp_producto FOREIGN KEY (producto_id) 
        REFERENCES producto(id) ON DELETE RESTRICT
);
```



---

### Sugerencias de Enlazado y Tags

**Enlaces sugeridos:**

- [[Normalización de Bases de Datos]] (Para entender la separación de tablas).
    
- [[Integridad Referencial]] (Cascade vs Restrict).
    
- [[Variables de Entorno en Java]] (Seguridad).
    
- [[Patrones de Diseño - Singleton y Static]]
    

Tags recomendados:

#sql #ddl #postgres #jdbc #java #seguridad #backend